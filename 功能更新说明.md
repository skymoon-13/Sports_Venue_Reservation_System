# 功能更新说明

## 已修复的问题

### 1. ✅ 管理员取消预约功能
- **问题**：管理员登录后只能预约不能取消预约
- **修复**：
  - 管理员现在可以取消任何预约（不受时间限制）
  - 在预约管理界面显示"取消预约（管理员）"按钮
  - 管理员查看预约列表时可以看到所有用户的预约

### 2. ✅ 管理员功能完善
- **新增功能**：
  - **场馆管理**：创建、编辑、删除场馆，设置开放时间、容量、收费标准
  - **预约管理**：查看所有预约，取消任何预约
  - **数据统计**：
    - 各场馆预约次数统计
    - 总预约数和今日预约数
    - 时段分析（按小时统计预约数量）
    - 日期分析（最近30天预约趋势）
  - **用户反馈管理**：
    - 查看所有用户反馈
    - 回复用户反馈
    - 更新反馈状态（待处理/处理中/已解决）

### 3. ✅ 用户注册功能
- **说明**：教师和学生需要注册账号
- **注册方式**：
  - 点击页面上的"注册"按钮
  - 选择角色：学生（student）或教职工（teacher）
  - 填写用户名、邮箱、密码
  - 注册成功后即可登录使用

## 功能说明

### 管理员功能

登录管理员账号（admin/admin123）后，可以看到：

1. **场馆管理**
   - 创建新场馆（设置名称、位置、容量、开放时间、收费标准）
   - 查看所有场馆
   - 编辑场馆信息
   - 删除场馆

2. **预约管理**
   - 查看所有用户的预约
   - 取消任何预约（不受时间限制）
   - 修改预约信息

3. **数据统计**
   - 总体统计：总预约数、今日预约数
   - 场馆统计：各场馆预约次数
   - 时段分析：按小时统计预约数量
   - 日期分析：最近30天预约趋势

4. **用户反馈**
   - 查看所有用户反馈
   - 回复用户反馈
   - 标记反馈状态

### 普通用户功能

注册并登录后，可以：

1. **查看场馆**
   - 浏览所有可用场馆
   - 查看场馆详情

2. **创建预约**
   - 选择场馆、日期、时间段
   - 系统自动计算费用：
     - 学生：按场馆收费标准 × 时长
     - 教职工：免费（price = 0）

3. **管理预约**
   - 查看我的预约列表
   - 取消预约（开场前1小时内禁止取消）

4. **提交反馈**
   - 提交问题或建议
   - 查看反馈状态和回复

## 使用指南

### 管理员操作流程

1. **登录管理员账号**
   - 用户名：`admin`
   - 密码：`admin123`

2. **创建场馆**
   - 点击"场馆管理"标签
   - 点击"创建新场馆"按钮
   - 填写场馆信息并提交

3. **查看统计**
   - 点击"数据统计"标签
   - 查看各项统计数据

4. **管理预约**
   - 点击"预约管理"标签
   - 查看所有预约
   - 可以取消任何预约

5. **处理反馈**
   - 点击"用户反馈"标签
   - 查看用户反馈
   - 回复并更新状态

### 普通用户操作流程

1. **注册账号**
   - 点击"注册"按钮
   - 选择角色（学生/教职工）
   - 填写信息并提交

2. **登录**
   - 使用注册的用户名和密码登录

3. **创建预约**
   - 选择场馆
   - 选择日期和时间段
   - 提交预约（系统自动计算费用）

4. **查看预约**
   - 在"我的预约"中查看所有预约
   - 可以取消预约（开场前1小时内禁止）

## 注意事项

1. **管理员密码**：默认密码是 `admin123`，登录后请尽快修改
2. **预约规则**：
   - 单次预约时长不超过2小时
   - 同一用户同一时间段只能有一个有效预约
   - 开场前1小时内禁止取消（管理员不受此限制）
3. **费用计算**：
   - 学生按场馆收费标准计费
   - 教职工免费
4. **邮件通知**：需要配置邮件服务器（可选），如果不配置，通知会保存在数据库中

## API 接口

### 新增接口

- `GET /api/admin/statistics/time-analysis` - 获取时段分析统计
- `GET /api/admin/feedbacks` - 获取所有用户反馈
- `POST /api/admin/feedbacks/<id>/reply` - 回复用户反馈
- `PUT /api/admin/feedbacks/<id>/status` - 更新反馈状态
- `POST /api/feedbacks` - 用户提交反馈
- `GET /api/feedbacks` - 获取我的反馈列表

## 数据库更新

新增表：
- `feedbacks` - 用户反馈表

运行以下命令更新数据库：
```bash
python init_db.py
```

或者重启应用，数据库表会自动创建。

